import{aa as e,ab as t,ac as n,a0 as s,k as a,ad as r,V as i}from"./index-414aba9e.js";var o={};Object.defineProperty(o,"__esModule",{value:!0});var u=o.createUniFetch=void 0;function l(s){var a,r;const i=[],o=s=>(!s.url.startsWith("http")&&o.baseURL&&(s.url=o.baseURL+s.url),o.intercept.request(s),(null==o?void 0:o.loading)&&!i.length&&e(Object.assign({},o.loading)),i.push("loading"),new Promise(((e,a)=>{t(Object.assign(Object.assign({},s),{success:t=>{e(o.intercept.response(Object.assign(Object.assign({},t),{config:s})))},fail:a,complete:()=>{i.pop(),i.length||n()}}))})));return o.loading=null==s?void 0:s.loading,o.baseURL=null==s?void 0:s.baseURL,o.intercept={request:e=>e,response:e=>e},(null===(a=null==s?void 0:s.intercept)||void 0===a?void 0:a.request)&&(o.intercept.request=s.intercept.request),(null===(r=null==s?void 0:s.intercept)||void 0===r?void 0:r.response)&&(o.intercept.response=s.intercept.response),o.get=function(e,t={}){return o({url:e,method:"GET",data:t})},o.post=function(e,t={}){return o({url:e,method:"POST",data:t})},o.put=function(e,t={}){return o({url:e,method:"PUT",data:t})},o.delete=function(e,t){return o({url:e,method:"DELETE",data:t})},o}u=o.createUniFetch=l,o.default=l();const c=s("counter",(()=>{const e=a("");return{count:e,setToken:t=>{e.value=t}}}),{persist:!0}),d=["pages/task/index","pages/message/index","pages/my/index"],p=u({loading:{title:"正在加载..."},baseURL:"https://slwl-api.itheima.net",intercept:{request(e){const t={Authorization:c().count};return e.header=Object.assign({},t,e.header),e},response(e){if(200===e.statusCode&&200===e.data.code)return e.data;if(401===e.statusCode){const e=r(),t=e[e.length-1].route,n=d.includes(t)?"switchTab":"redirectTo";return console.log(t),i({url:`/pages/login/index?routeType=${n}&redirectUrl=/${t}`})}uni.utils.toast(e.data.msg||"请求失败")}}});export{p as a,c as u};
